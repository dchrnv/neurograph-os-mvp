# Руководство разработчика

## Оглавление
1. [Начало работы](#начало-работы)
2. [Структура проекта](#структура-проекта)
3. [Стандарты кода](#стандарты-кода)
4. [Работа с Git](#работа-с-git)
5. [Тестирование](#тестирование)
6. [Документация](#документация)
7. [Ревью кода](#ревью-кода)
8. [Развертывание](#развертывание)

## Начало работы

### Предварительные требования
- Python 3.10+
- PostgreSQL 13+
- Redis 6+
- Docker и Docker Compose

### Установка

1. Клонируйте репозиторий:
   ```bash
   git clone https://github.com/yourusername/neurograph-os.git
   cd neurograph-os
   ```

2. Создайте и активируйте виртуальное окружение:
   ```bash
   python -m venv venv
   source venv/bin/activate  # Linux/Mac
   # ИЛИ
   .\venv\Scripts\activate  # Windows
   ```

3. Установите зависимости:
   ```bash
   pip install -r requirements/dev.txt
   ```

4. Настройте переменные окружения:
   ```bash
   cp .env.example .env
   # Отредактируйте .env по необходимости
   ```

5. Запустите сервисы:
   ```bash
   docker-compose up -d
   ```

6. Примените миграции:
   ```bash
   alembic upgrade head
   ```

7. Запустите сервер разработки:
   ```bash
   uvicorn app.main:app --reload
   ```

## Структура проекта

```
src/
├── core/                 # Ядро системы
│   ├── domain/          # Доменные модели
│   ├── application/     # Сценарии использования
│   └── infrastructure/  # Реализация инфраструктуры
├── api/                 # API слой
│   ├── endpoints/       # Конечные точки API
│   └── middleware/      # Промежуточное ПО
└── tests/               # Тесты
```

## Стандарты кода

### Форматирование
- Используйте `black` для форматирования кода
- Строки должны быть не длиннее 88 символов
- Импорты должны быть сгруппированы и отсортированы с помощью `isort`

### Типизация
- Всегда используйте аннотации типов
- Используйте `mypy` для проверки типов
- Избегайте `Any` без крайней необходимости

### Документирование
- Пишите docstrings в формате Google Style
- Документируйте все публичные функции и классы
- Используйте type hints для всех параметров и возвращаемых значений

## Работа с Git

### Ветки
- `main` - стабильная версия
- `develop` - ветка для разработки
- `feature/*` - новая функциональность
- `bugfix/*` - исправление багов
- `hotfix/*` - срочные исправления

### Коммиты
Сообщения коммитов должны следовать формату:
```
<тип>(<область>): <сообщение>

[опциональное тело]

[опциональная сноска]
```

**Типы:**
- `feat`: Новая функциональность
- `fix`: Исправление ошибок
- `docs`: Изменения в документации
- `style`: Форматирование, отсутствующие точки с запятой и т.д.
- `refactor`: Рефакторинг кода
- `test`: Добавление тестов
- `chore`: Обновление задач сборки, настройки и т.д.

## Тестирование

### Управление сложностью и кодом "на вырост"

В проекте могут существовать сложные или избыточные на текущем этапе компоненты, которые являются заделом на будущее (например, генетические операторы в графе, сложные стратегии сэмплинга и т.д.).

**Принцип:** Мы не удаляем такой код. Вместо этого мы его временно "выключаем", чтобы он не мешал запуску и отладке текущей версии.

**Как это делать:**
1.  **Комментирование:** Если функциональность инкапсулирована в нескольких методах, их можно закомментировать.
2.  **Флаги в конфигурации:** Предпочтительный способ. Добавьте флаг `enabled: false` в соответствующий `config/*.yaml` файл. Код должен проверять этот флаг перед выполнением сложной логики.
3.  **Документация:** Любое временное отключение должно сопровождаться комментарием `TODO (v0.2):` или `FEATURE_FLAG:` с кратким пояснением, что и почему отключено, и когда планируется это включить.

Этот подход позволяет нам быстро двигаться к MVP, не теряя архитектурный задел.

---

### Запуск тестов
```bash
# Все тесты
pytest

# Конкретный тест
pytest tests/test_module.py::test_function

# С покрытием кода
pytest --cov=src
```

### Написание тестов
- Используйте `pytest` в качестве фреймворка
- Следуйте принципу AAA (Arrange-Act-Assert)
- Используйте фикстуры для общих настроек
- Называйте тесты по шаблону: `test_<что_тестируем>_<условие>_<ожидаемый_результат>`

## Документация

### Генерация документации
```bash
# Установите зависимости для документации
pip install -r requirements/doc.txt

# Сгенерируйте документацию
cd docs && make html
```

### Обновление документации
1. Обновите docstrings в коде
2. Обновите соответствующие файлы в `docs/source/`
3. Убедитесь, что документация генерируется без ошибок
4. Создайте PR с изменениями

## Ревью кода

### Перед отправкой на ревью
1. Запустите линтеры: `make lint`
2. Запустите тесты: `make test`
3. Убедитесь, что покрытие кода не ухудшилось
4. Обновите документацию, если это необходимо

### Во время ревью
1. Будьте вежливы и конструктивны
2. Обращайте внимание на:
   - Качество кода
   - Производительность
   - Безопасность
   - Тестовое покрытие

## Развертывание

### Тестовое окружение
```bash
# Сборка и запуск
make build
make up

# Остановка
make down
```

### Продакшн
1. Создайте тег: `git tag v1.0.0`
2. Отправьте тег: `git push origin v1.0.0`
3. CI/CD автоматически развернет изменения

## Устранение неполадок

### Общие проблемы
1. **Проблема с зависимостями**
   - Удалите `venv` и установите заново
   - Убедитесь, что используете правильную версию Python

2. **Проблемы с базой данных**
   - Проверьте подключение к БД
   - Запустите миграции: `alembic upgrade head`

3. **Проблемы с кэшем**
   - Очистите кэш Redis: `redis-cli FLUSHALL`

## Контакты
- Вопросы: dev@example.com
- Баги: issues@example.com
- Обсуждение: slack.example.com
