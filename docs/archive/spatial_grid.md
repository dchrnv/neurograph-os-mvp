# Пространственная сетка (SparseGrid)

## Назначение
Эффективная структура данных для хранения и поиска токенов в трёхмерном пространстве.

## Основные характеристики
- **Тип**: Разреженная 3D-сетка
- **Диапазон координат**: от -1.0 до +1.0 по каждой оси
- **Точность**: Настраиваемая (по умолчанию 2 знака после запятой)
- **Внутреннее хранилище**: Словарь с кортежами координат в качестве ключей

## Интерфейс

### Инициализация
```python
grid = SparseGrid(precision=2)  # precision - количество знаков после запятой
```

### Основные методы

#### Добавление токена
```python
grid.insert(x=0.5, y=-0.3, z=0.1, token=my_token)
```

#### Получение токена
```python
token = grid.get(x=0.5, y=-0.3, z=0.1)
```

#### Удаление токена
```python
grid.remove(x=0.5, y=-0.3, z=0.1)
```

#### Проверка наличия токена
```python
if grid.contains(0.5, -0.3, 0.1):
    # Действие, если токен существует
```

#### Итерация по всем токенам
```python
for (x, y, z), token in grid.occupied_cells():
    # Обработка токена
```

### Внутренняя работа
1. **Округление координат**:
   ```python
   # Пример с precision=2
   x = 0.1234 → 0.12
   y = -0.5678 → -0.57
   ```

2. **Хранение**:
   ```python
   {
       (0.12, -0.57, 0.10): token1,
       (-0.33, 0.45, 0.22): token2,
       # ...
   }
   ```

## Пример использования
```python
from core.spatial.grid import SparseGrid
from core.token.token import Token

# Создание сетки
grid = SparseGrid(precision=2)

# Создание и добавление токенов
for i in range(5):
    token = Token()
    x = i * 0.2 - 0.5  # от -0.5 до 0.5
    y = (i % 3) * 0.3 - 0.3
    z = 0.0
    grid.insert(x, y, z, token)

# Поиск токена
token = grid.get(0.1, 0.0, 0.0)
if token:
    print(f"Найден токен с ID: {token.id}")

# Итерация по всем занятым ячейкам
for (x, y, z), token in grid.occupied_cells():
    print(f"Токен {token.id} в позиции ({x}, {y}, {z})")
```

## Производительность
- **Вставка**: O(1)
- **Поиск**: O(1)
- **Память**: O(n), где n - количество занятых ячеек

## Ограничения
- Фиксированный диапазон координат (-1.0, 1.0)
- Нет поддержки поиска по радиусу (в текущей реализации)
- Ограниченная точность из-за округления
