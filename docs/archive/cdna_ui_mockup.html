<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CDNA v2.1 — Панель управления</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: #2d3748;
            padding: 20px;
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
        }

        .header {
            background: white;
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .header h1 {
            font-size: 32px;
            color: #1a202c;
            margin-bottom: 8px;
        }

        .header .subtitle {
            color: #718096;
            font-size: 14px;
        }

        .status-bar {
            display: flex;
            gap: 16px;
            margin-top: 16px;
        }

        .status-badge {
            padding: 8px 16px;
            border-radius: 8px;
            font-size: 13px;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .status-badge.stable {
            background: #c6f6d5;
            color: #22543d;
        }

        .status-badge.quarantine {
            background: #feebc8;
            color: #7c2d12;
        }

        .status-badge.failed {
            background: #fed7d7;
            color: #742a2a;
        }

        .main-grid {
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 24px;
        }

        .sidebar {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.1);
        }

        .card h2 {
            font-size: 18px;
            color: #1a202c;
            margin-bottom: 16px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .profile-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .profile-item {
            padding: 12px 16px;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.2s;
            border: 2px solid transparent;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .profile-item:hover {
            background: #f7fafc;
        }

        .profile-item.active {
            background: #ebf4ff;
            border-color: #4299e1;
        }

        .profile-icon {
            width: 32px;
            height: 32px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
        }

        .profile-info {
            flex: 1;
        }

        .profile-name {
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
        }

        .profile-desc {
            font-size: 12px;
            color: #718096;
        }

        .content-area {
            display: flex;
            flex-direction: column;
            gap: 24px;
        }

        .dimension-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .dimension-card {
            background: white;
            border-radius: 12px;
            padding: 20px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.08);
        }

        .dimension-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .dimension-name {
            font-weight: 600;
            font-size: 14px;
            color: #2d3748;
        }

        .dimension-value {
            font-weight: 700;
            font-size: 18px;
            color: #4299e1;
        }

        .slider-container {
            position: relative;
            margin-bottom: 8px;
        }

        .slider {
            width: 100%;
            height: 8px;
            border-radius: 4px;
            outline: none;
            -webkit-appearance: none;
            appearance: none;
            cursor: pointer;
        }

        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
            box-shadow: 0 2px 8px rgba(66, 153, 225, 0.4);
        }

        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #4299e1;
            cursor: pointer;
            border: none;
            box-shadow: 0 2px 8px rgba(66, 153, 225, 0.4);
        }

        .zones-indicator {
            display: flex;
            height: 24px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 8px;
        }

        .zone {
            flex: 1;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
        }

        .zone.green {
            background: #48bb78;
            color: white;
        }

        .zone.yellow {
            background: #ecc94b;
            color: #744210;
        }

        .zone.red {
            background: #f56565;
            color: white;
        }

        .zone-labels {
            display: flex;
            justify-content: space-between;
            font-size: 11px;
            color: #a0aec0;
        }

        .action-buttons {
            display: flex;
            gap: 12px;
            margin-top: 24px;
        }

        .btn {
            padding: 12px 24px;
            border-radius: 8px;
            border: none;
            font-weight: 600;
            font-size: 14px;
            cursor: pointer;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-primary {
            background: #4299e1;
            color: white;
        }

        .btn-primary:hover {
            background: #3182ce;
            transform: translateY(-1px);
            box-shadow: 0 4px 12px rgba(66, 153, 225, 0.3);
        }

        .btn-secondary {
            background: #e2e8f0;
            color: #2d3748;
        }

        .btn-secondary:hover {
            background: #cbd5e0;
        }

        .btn-danger {
            background: #fc8181;
            color: white;
        }

        .btn-danger:hover {
            background: #f56565;
        }

        .quarantine-panel {
            background: linear-gradient(135deg, #fef5e7 0%, #f9e4b7 100%);
            border-radius: 12px;
            padding: 24px;
            border: 2px solid #f6ad55;
        }

        .quarantine-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 16px;
        }

        .quarantine-icon {
            width: 48px;
            height: 48px;
            background: #ed8936;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
        }

        .quarantine-info h3 {
            font-size: 18px;
            color: #7c2d12;
            margin-bottom: 4px;
        }

        .quarantine-info p {
            font-size: 13px;
            color: #9c4221;
        }

        .progress-bar {
            height: 8px;
            background: #fbd38d;
            border-radius: 4px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #ed8936 0%, #dd6b20 100%);
            transition: width 0.3s;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            margin-top: 16px;
        }

        .metric-card {
            background: white;
            padding: 12px;
            border-radius: 8px;
            text-align: center;
        }

        .metric-value {
            font-size: 24px;
            font-weight: 700;
            color: #2d3748;
        }

        .metric-label {
            font-size: 11px;
            color: #718096;
            margin-top: 4px;
        }

        .metric-status {
            font-size: 12px;
            font-weight: 600;
            margin-top: 4px;
        }

        .metric-status.ok {
            color: #38a169;
        }

        .metric-status.warning {
            color: #d69e2e;
        }

        .metric-status.error {
            color: #e53e3e;
        }

        .history-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 300px;
            overflow-y: auto;
        }

        .history-item {
            padding: 12px;
            border-radius: 8px;
            background: #f7fafc;
            border-left: 4px solid #cbd5e0;
            cursor: pointer;
            transition: all 0.2s;
        }

        .history-item:hover {
            background: #edf2f7;
            border-left-color: #4299e1;
        }

        .history-item.current {
            border-left-color: #48bb78;
            background: #f0fff4;
        }

        .history-time {
            font-size: 12px;
            color: #718096;
            margin-bottom: 4px;
        }

        .history-desc {
            font-size: 13px;
            color: #2d3748;
            font-weight: 500;
        }

        .impact-badge {
            display: inline-block;
            padding: 2px 8px;
            border-radius: 4px;
            font-size: 11px;
            font-weight: 600;
            margin-left: 8px;
        }

        .impact-low {
            background: #c6f6d5;
            color: #22543d;
        }

        .impact-medium {
            background: #feebc8;
            color: #7c2d12;
        }

        .impact-high {
            background: #fed7d7;
            color: #742a2a;
        }

        .hidden {
            display: none;
        }

        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }

        .pulsing {
            animation: pulse 2s infinite;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🧬 CDNA v2.1 — Панель управления</h1>
            <p class="subtitle">Cognitive DNA Configuration Manager</p>
            
            <div class="status-bar">
                <div class="status-badge stable" id="statusBadge">
                    <span>●</span>
                    <span>СТАБИЛЬНАЯ</span>
                </div>
                <div class="status-badge" style="background: #e6fffa; color: #234e52;">
                    <span>📦</span>
                    <span>384 байта</span>
                </div>
                <div class="status-badge" style="background: #fef5e7; color: #744210;">
                    <span>⚡</span>
                    <span>6 кеш-линий</span>
                </div>
            </div>
        </div>

        <div class="main-grid">
            <!-- Боковая панель -->
            <div class="sidebar">
                <!-- Профили -->
                <div class="card">
                    <h2>📋 Профили</h2>
                    <div class="profile-list">
                        <div class="profile-item active" data-profile="explorer">
                            <div class="profile-icon" style="background: #bee3f8;">🔍</div>
                            <div class="profile-info">
                                <div class="profile-name">Исследователь</div>
                                <div class="profile-desc">Свободная структура</div>
                            </div>
                        </div>
                        <div class="profile-item" data-profile="analyzer">
                            <div class="profile-icon" style="background: #fed7e2;">🔬</div>
                            <div class="profile-info">
                                <div class="profile-name">Аналитик</div>
                                <div class="profile-desc">Строгие правила</div>
                            </div>
                        </div>
                        <div class="profile-item" data-profile="creative">
                            <div class="profile-icon" style="background: #fefcbf;">🎨</div>
                            <div class="profile-info">
                                <div class="profile-name">Творческий</div>
                                <div class="profile-desc">Экспериментальный</div>
                            </div>
                        </div>
                        <div class="profile-item" data-profile="quarantine">
                            <div class="profile-icon" style="background: #fbd38d;">🛡️</div>
                            <div class="profile-info">
                                <div class="profile-name">Карантин</div>
                                <div class="profile-desc">Безопасные изменения</div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- История -->
                <div class="card">
                    <h2>📜 История версий</h2>
                    <div class="history-list" id="historyList">
                        <div class="history-item current">
                            <div class="history-time">Сейчас (активна)</div>
                            <div class="history-desc">Профиль: Исследователь</div>
                        </div>
                        <div class="history-item">
                            <div class="history-time">5 минут назад</div>
                            <div class="history-desc">
                                Увеличен масштаб ABSTRACT → 15.0
                                <span class="impact-badge impact-medium">СРЕДНИЙ</span>
                            </div>
                        </div>
                        <div class="history-item">
                            <div class="history-time">2 часа назад</div>
                            <div class="history-desc">
                                Смена профиля: Аналитик → Исследователь
                                <span class="impact-badge impact-high">ВЫСОКИЙ</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Основная область -->
            <div class="content-area">
                <!-- Карантин (скрыт по умолчанию) -->
                <div class="quarantine-panel hidden" id="quarantinePanel">
                    <div class="quarantine-header">
                        <div class="quarantine-icon">⏱️</div>
                        <div class="quarantine-info">
                            <h3>Режим карантина активен</h3>
                            <p>Тестирование новой конфигурации: <span id="quarantineTime">300</span>с осталось</p>
                        </div>
                    </div>
                    
                    <div class="progress-bar">
                        <div class="progress-fill" id="quarantineProgress" style="width: 0%"></div>
                    </div>

                    <div class="metrics-grid">
                        <div class="metric-card">
                            <div class="metric-value" id="metricMemory">+8%</div>
                            <div class="metric-label">Рост памяти</div>
                            <div class="metric-status ok">✓ OK (< 20%)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="metricBreaks">3</div>
                            <div class="metric-label">Разрывы связей</div>
                            <div class="metric-status ok">✓ OK (< 10)</div>
                        </div>
                        <div class="metric-card">
                            <div class="metric-value" id="metricChurn">12%</div>
                            <div class="metric-label">Обновление токенов</div>
                            <div class="metric-status ok">✓ OK (< 30%)</div>
                        </div>
                    </div>

                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="applyChanges()">
                            <span>✓</span>
                            Применить сейчас
                        </button>
                        <button class="btn btn-danger" onclick="cancelQuarantine()">
                            <span>✕</span>
                            Отменить
                        </button>
                    </div>
                </div>

                <!-- Управление измерениями -->
                <div class="card">
                    <h2>🎛️ Масштабы измерений</h2>
                    <div class="dimension-controls" id="dimensionControls">
                        <!-- Заполняется JavaScript -->
                    </div>
                </div>

                <!-- Кнопки действий -->
                <div class="card">
                    <h2>⚙️ Действия</h2>
                    <div class="action-buttons">
                        <button class="btn btn-primary" onclick="proposeChanges()">
                            <span>🧪</span>
                            Протестировать изменения
                        </button>
                        <button class="btn btn-secondary" onclick="resetToDefaults()">
                            <span>↺</span>
                            Сбросить к умолчаниям
                        </button>
                        <button class="btn btn-secondary" onclick="exportCDNA()">
                            <span>💾</span>
                            Экспортировать CDNA
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Данные измерений
        const dimensions = [
            { id: 'physical', name: 'PHYSICAL', icon: '🏃', default: 1.0, min: 0, max: 20, green: [1, 5], yellow: [5, 15], red: [15, 20] },
            { id: 'sensory', name: 'SENSORY', icon: '👁️', default: 1.5, min: 0, max: 20, green: [1, 5], yellow: [5, 15], red: [15, 20] },
            { id: 'motor', name: 'MOTOR', icon: '✋', default: 1.2, min: 0, max: 20, green: [1, 5], yellow: [5, 15], red: [15, 20] },
            { id: 'emotional', name: 'EMOTIONAL', icon: '❤️', default: 2.0, min: 0, max: 20, green: [1, 8], yellow: [8, 15], red: [15, 20] },
            { id: 'cognitive', name: 'COGNITIVE', icon: '🧠', default: 3.0, min: 0, max: 30, green: [1, 15], yellow: [15, 25], red: [25, 30] },
            { id: 'social', name: 'SOCIAL', icon: '👥', default: 2.5, min: 0, max: 20, green: [1, 10], yellow: [10, 15], red: [15, 20] },
            { id: 'temporal', name: 'TEMPORAL', icon: '⏰', default: 2.0, min: 0, max: 20, green: [1, 8], yellow: [8, 15], red: [15, 20] },
            { id: 'abstract', name: 'ABSTRACT', icon: '💭', default: 10.0, min: 0, max: 50, green: [1, 20], yellow: [20, 40], red: [40, 50] }
        ];

        // Профили
        const profiles = {
            explorer: {
                name: 'Исследователь',
                scales: [1.0, 1.5, 1.2, 2.0, 3.0, 2.5, 2.0, 5.0],
                description: 'Свободная структура, высокая эволюция'
            },
            analyzer: {
                name: 'Аналитик',
                scales: [1.0, 1.0, 1.0, 1.5, 10.0, 5.0, 3.0, 20.0],
                description: 'Строгие правила, низкая эволюция'
            },
            creative: {
                name: 'Творческий',
                scales: [1.0, 2.0, 3.0, 5.0, 8.0, 13.0, 21.0, 34.0],
                description: 'Экспериментальный, высокая вариативность'
            },
            quarantine: {
                name: 'Карантин',
                scales: [1.0, 1.0, 1.0, 1.0, 2.0, 1.5, 1.0, 3.0],
                description: 'Изолированный режим для безопасного внесения изменений',
                restricted: true,
                maxChange: 0.5, // Максимальное изменение за раз
                requireValidation: true
            }
        };

        let currentProfile = 'explorer';
        let currentValues = [...profiles.explorer.scales];
        let isQuarantineActive = false;
        let quarantineTimer = null;

        // Инициализация
        function init() {
            renderDimensionControls();
            setupProfileSwitching();
        }

        // Рендер контролов измерений
        function renderDimensionControls() {
            const container = document.getElementById('dimensionControls');
            container.innerHTML = '';

            dimensions.forEach((dim, index) => {
                const value = currentValues[index];
                const status = getZoneStatus(value, dim);
                
                const card = document.createElement('div');
                card.className = 'dimension-card';
                card.innerHTML = `
                    <div class="dimension-header">
                        <span class="dimension-name">${dim.icon} ${dim.name}</span>
                        <span class="dimension-value" id="value-${dim.id}">${value.toFixed(1)}</span>
                    </div>
                    
                    <div class="zones-indicator">
                        <div class="zone green">🟢 Безопасно</div>
                        <div class="zone yellow">🟡 Осторожно</div>
                        <div class="zone red">🔴 Опасно</div>
                    </div>

                    <div class="slider-container">
                        <input type="range" 
                               class="slider" 
                               id="slider-${dim.id}"
                               min="${dim.min}" 
                               max="${dim.max}" 
                               step="0.1" 
                               value="${value}"
                               style="background: linear-gradient(90deg, 
                                   #48bb78 0%, 
                                   #48bb78 ${(dim.green[1] / dim.max) * 100}%, 
                                   #ecc94b ${(dim.green[1] / dim.max) * 100}%, 
                                   #ecc94b ${(dim.yellow[1] / dim.max) * 100}%, 
                                   #f56565 ${(dim.yellow[1] / dim.max) * 100}%, 
                                   #f56565 100%)"
                               oninput="updateValue('${dim.id}', ${index}, this.value)">
                    </div>

                    <div class="zone-labels">
                        <span>${dim.min}</span>
                        <span>${dim.green[1]}</span>
                        <span>${dim.yellow[1]}</span>
                        <span>${dim.max}</span>
                    </div>
                `;
                container.appendChild(card);
            });
        }

        // Получить статус зоны
        function getZoneStatus(value, dim) {
            if (value >= dim.green[0] && value <= dim.green[1]) return 'green';
            if (value > dim.green[1] && value <= dim.yellow[1]) return 'yellow';
            return 'red';
        }

        // Обновить значение
        function updateValue(id, index, value) {
            value = parseFloat(value);
            
            // Проверка ограничений для профиля Карантин
            if (profiles[currentProfile].restricted) {
                const originalValue = profiles[currentProfile].scales[index];
                const maxChange = profiles[currentProfile].maxChange;
                const diff = Math.abs(value - originalValue);
                
                if (diff > maxChange) {
                    // Ограничить изменение
                    if (value > originalValue) {
                        value = originalValue + maxChange;
                    } else {
                        value = originalValue - maxChange;
                    }
                    
                    // Показать предупреждение
                    showChangeRestrictionWarning(maxChange);
                }
            }
            
            currentValues[index] = value;
            document.getElementById(`value-${id}`).textContent = value.toFixed(1);
            
            // Обновить слайдер если значение было ограничено
            const slider = document.getElementById(`slider-${id}`);
            if (slider && parseFloat(slider.value) !== value) {
                slider.value = value;
            }
        }

        // Предупреждение об ограничении изменений
        function showChangeRestrictionWarning(maxChange) {
            // Проверить, не показывается ли уже предупреждение
            if (document.querySelector('.restriction-warning')) return;
            
            const warning = document.createElement('div');
            warning.className = 'restriction-warning';
            warning.style.cssText = `
                position: fixed;
                bottom: 20px;
                right: 20px;
                background: linear-gradient(135deg, #fed7d7 0%, #fc8181 100%);
                border: 2px solid #f56565;
                border-radius: 12px;
                padding: 16px 20px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                z-index: 1000;
                max-width: 350px;
                animation: slideInBottom 0.3s ease-out;
            `;
            warning.innerHTML = `
                <div style="display: flex; align-items: center; gap: 12px;">
                    <div style="font-size: 24px;">⚠️</div>
                    <div style="flex: 1;">
                        <div style="font-weight: 600; color: #742a2a; margin-bottom: 4px; font-size: 14px;">
                            Ограничение изменений
                        </div>
                        <div style="font-size: 12px; color: #9b2c2c;">
                            В режиме Карантин изменение ограничено ±${maxChange}
                        </div>
                    </div>
                </div>
            `;

            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideInBottom {
                    from {
                        transform: translateY(100px);
                        opacity: 0;
                    }
                    to {
                        transform: translateY(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(warning);

            setTimeout(() => {
                if (warning.parentElement) {
                    warning.style.animation = 'slideInBottom 0.3s ease-out reverse';
                    setTimeout(() => warning.remove(), 300);
                }
            }, 2000);
        }

        // Переключение профилей
        function setupProfileSwitching() {
            document.querySelectorAll('.profile-item').forEach(item => {
                item.addEventListener('click', function() {
                    const profile = this.dataset.profile;
                    switchProfile(profile);
                });
            });
        }

        function switchProfile(profile) {
            if (profile === currentProfile) return;

            // Обновить UI
            document.querySelectorAll('.profile-item').forEach(item => {
                item.classList.remove('active');
            });
            document.querySelector(`[data-profile="${profile}"]`).classList.add('active');

            // Обновить значения
            currentProfile = profile;
            currentValues = [...profiles[profile].scales];
            renderDimensionControls();

            // Показать уведомление для профиля Карантин
            if (profile === 'quarantine') {
                showQuarantineNotification();
            }
        }

        // Уведомление о режиме карантина
        function showQuarantineNotification() {
            const notification = document.createElement('div');
            notification.style.cssText = `
                position: fixed;
                top: 20px;
                right: 20px;
                background: linear-gradient(135deg, #fef5e7 0%, #f9e4b7 100%);
                border: 2px solid #f6ad55;
                border-radius: 12px;
                padding: 20px;
                box-shadow: 0 10px 40px rgba(0,0,0,0.2);
                z-index: 1000;
                max-width: 400px;
                animation: slideIn 0.3s ease-out;
            `;
            notification.innerHTML = `
                <div style="display: flex; align-items: start; gap: 12px;">
                    <div style="font-size: 32px;">🛡️</div>
                    <div>
                        <h3 style="margin: 0 0 8px 0; color: #7c2d12; font-size: 16px;">
                            Режим Карантина активирован
                        </h3>
                        <p style="margin: 0; font-size: 13px; color: #9c4221; line-height: 1.5;">
                            • Ограниченные изменения параметров<br>
                            • Автоматическая валидация<br>
                            • Максимальное изменение: ±0.5<br>
                            • Безопасное тестирование
                        </p>
                        <button onclick="this.parentElement.parentElement.parentElement.remove()" 
                                style="margin-top: 12px; padding: 6px 12px; background: #ed8936; 
                                       color: white; border: none; border-radius: 6px; 
                                       cursor: pointer; font-size: 12px; font-weight: 600;">
                            Понятно
                        </button>
                    </div>
                </div>
            `;

            // Добавить анимацию
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideIn {
                    from {
                        transform: translateX(400px);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            document.body.appendChild(notification);

            // Автоматически удалить через 5 секунд
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.style.animation = 'slideIn 0.3s ease-out reverse';
                    setTimeout(() => notification.remove(), 300);
                }
            }, 5000);
        }

        // Предложить изменения (запустить карантин)
        function proposeChanges() {
            isQuarantineActive = true;
            document.getElementById('quarantinePanel').classList.remove('hidden');
            document.getElementById('statusBadge').className = 'status-badge quarantine';
            document.getElementById('statusBadge').innerHTML = '<span>●</span><span>КАРАНТИН</span>';

            // Симуляция карантина
            let timeLeft = 300;
            let progress = 0;

            quarantineTimer = setInterval(() => {
                timeLeft -= 10;
                progress = ((300 - timeLeft) / 300) * 100;

                document.getElementById('quarantineTime').textContent = timeLeft;
                document.getElementById('quarantineProgress').style.width = progress + '%';

                // Симуляция метрик
                const memGrowth = Math.floor(Math.random() * 15) + 3;
                const breaks = Math.floor(Math.random() * 8) + 1;
                const churn = Math.floor(Math.random() * 25) + 5;

                document.getElementById('metricMemory').textContent = `+${memGrowth}%`;
                document.getElementById('metricBreaks').textContent = breaks;
                document.getElementById('metricChurn').textContent = `${churn}%`;

                // Обновить статусы
                updateMetricStatus('Memory', memGrowth, 20);
                updateMetricStatus('Breaks', breaks, 10);
                updateMetricStatus('Churn', churn, 30);

                if (timeLeft <= 0) {
                    clearInterval(quarantineTimer);
                    applyChanges();
                }
            }, 100); // Ускоренная симуляция
        }

        function updateMetricStatus(metric, value, threshold) {
            const statusElement = document.querySelector(`#metric${metric} + .metric-label + .metric-status`);
            if (!statusElement) return;

            if (value < threshold) {
                statusElement.className = 'metric-status ok';
                statusElement.textContent = `✓ OK (< ${threshold}${metric === 'Memory' || metric === 'Churn' ? '%' : ''})`;
            } else {
                statusElement.className = 'metric-status error';
                statusElement.textContent = `✗ ПРЕВЫШЕНО (> ${threshold}${metric === 'Memory' || metric === 'Churn' ? '%' : ''})`;
            }
        }

        // Применить изменения
        function applyChanges() {
            if (quarantineTimer) clearInterval(quarantineTimer);
            
            isQuarantineActive = false;
            document.getElementById('quarantinePanel').classList.add('hidden');
            document.getElementById('statusBadge').className = 'status-badge stable';
            document.getElementById('statusBadge').innerHTML = '<span>●</span><span>СТАБИЛЬНАЯ</span>';

            // Добавить в историю
            const historyList = document.getElementById('historyList');
            const newItem = document.createElement('div');
            newItem.className = 'history-item';
            newItem.innerHTML = `
                <div class="history-time">Только что</div>
                <div class="history-desc">
                    Изменения применены успешно ✓
                    <span class="impact-badge impact-medium">СРЕДНИЙ</span>
                </div>
            `;
            historyList.insertBefore(newItem, historyList.children[1]);

            alert('✓ Изменения успешно применены!\n\nСистема работает стабильно.');
        }

        // Отменить карантин
        function cancelQuarantine() {
            if (quarantineTimer) clearInterval(quarantineTimer);
            
            isQuarantineActive = false;
            document.getElementById('quarantinePanel').classList.add('hidden');
            document.getElementById('statusBadge').className = 'status-badge stable';
            document.getElementById('statusBadge').innerHTML = '<span>●</span><span>СТАБИЛЬНАЯ</span>';

            // Откатить изменения
            switchProfile(currentProfile);

            alert('✕ Изменения отменены.\n\nСистема откачена к предыдущей версии.');
        }

        // Сбросить к умолчаниям
        function resetToDefaults() {
            if (confirm('Сбросить все параметры к значениям по умолчанию?')) {
                switchProfile('explorer');
                alert('↺ Параметры сброшены к профилю "Исследователь"');
            }
        }

        // Экспорт CDNA
        function exportCDNA() {
            const cdnaData = {
                version: '2.1.0',
                profile: currentProfile,
                dimension_scales: currentValues,
                timestamp: new Date().toISOString()
            };

            const dataStr = JSON.stringify(cdnaData, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = `cdna_${currentProfile}_${Date.now()}.json`;
            link.click();

            URL.revokeObjectURL(url);
        }

        // Запуск при загрузке
        init();
    </script>
</body>
</html>
