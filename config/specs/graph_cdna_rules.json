{
  "graph_cdna_specification": {
    "version": "1.0.0",
    "description": "CDNA правила для валидации операций TokenGraph",
    "last_updated": "2025-10-13",
    
    "graph_topology": {
      "description": "Правила топологии графа",
      
      "structure_limits": {
        "max_nodes": 1000000,
        "max_edges": 10000000,
        "max_degree": 1000,
        "max_subgraph_size": 10000,
        "allow_self_loops": false,
        "allow_multi_edges": false
      },
      
      "connection_types": {
        "allowed_types": [1, 2, 3, 4, 5, 6, 7, 8, 9, 10, 11, 12, 13, 14, 15, 16],
        "type_constraints": {
          "HIERARCHY": {
            "max_children": 100,
            "max_depth": 20,
            "bidirectional_allowed": false
          },
          "CAUSALITY": {
            "bidirectional_allowed": false,
            "requires_temporal_order": true
          },
          "SIMILARITY": {
            "bidirectional_default": true,
            "symmetric_weight": true
          },
          "MUTATION": {
            "bidirectional_allowed": false,
            "parent_required": true
          },
          "CROSSOVER": {
            "min_parents": 2,
            "max_parents": 2
          }
        }
      },
      
      "weight_constraints": {
        "min_weight": 0.01,
        "max_weight": 1.0,
        "default_weight": 0.5,
        "weight_precision": 0.01,
        "allow_negative": false
      },
      
      "spatial_constraints": {
        "enforce_distance_limit": false,
        "connection_distance_range": [0.0, 1000.0],
        "proximity_threshold": 10.0,
        "containment_strict": true
      }
    },
    
    "evolution_rules": {
      "description": "Правила эволюционных операторов",
      
      "mutation_constraints": {
        "min_mutation_rate": 0.0,
        "max_mutation_rate": 0.5,
        "max_mutations_per_cycle": 1000,
        "allowed_mutation_types": [
          "ADD_CONNECTION",
          "REMOVE_CONNECTION",
          "MODIFY_WEIGHT",
          "CHANGE_TYPE",
          "REVERSE_DIRECTION"
        ],
        "mutation_cooldown_seconds": 0,
        "preserve_critical_connections": true
      },
      
      "crossover_constraints": {
        "min_crossover_rate": 0.0,
        "max_crossover_rate": 0.3,
        "min_subgraph_size": 2,
        "max_subgraph_size": 1000,
        "crossover_point_range": [0.2, 0.8],
        "preserve_connectivity": true
      },
      
      "selection_constraints": {
        "min_fitness_threshold": 0.0,
        "max_fitness_threshold": 1.0,
        "selection_pressure_range": [0.0, 1.0],
        "protect_hub_nodes": true,
        "protect_bridge_connections": true,
        "min_survivors_percentage": 0.1
      },
      
      "fitness_calculation": {
        "weight_component": 0.4,
        "activity_component": 0.3,
        "recency_component": 0.3,
        "min_fitness": 0.0,
        "max_fitness": 1.0
      }
    },
    
    "operation_rules": {
      "description": "Правила для операций графа",
      
      "add_token_rules": {
        "require_unique_id": true,
        "require_valid_id": true,
        "check_capacity": true,
        "allow_duplicates": false
      },
      
      "add_connection_rules": {
        "require_existing_nodes": true,
        "validate_connection_type": true,
        "validate_weight": true,
        "check_degree_limit": true,
        "check_distance_limit": false,
        "prevent_redundant": true,
        "allow_during_evolution": true
      },
      
      "remove_token_rules": {
        "cascade_delete_connections": true,
        "require_confirmation": false,
        "preserve_critical_nodes": false
      },
      
      "remove_connection_rules": {
        "check_connectivity_impact": false,
        "preserve_bridges": false,
        "allow_during_evolution": true
      }
    },
    
    "validation_rules": {
      "description": "Правила валидации операций",
      
      "pre_operation_checks": {
        "validate_all_operations": true,
        "check_capacity_limits": true,
        "verify_constraints": true,
        "check_cdna_rules": true
      },
      
      "post_operation_checks": {
        "verify_consistency": true,
        "check_invariants": true,
        "update_indices": true,
        "record_to_experience": true
      },
      
      "integrity_checks": {
        "check_dangling_connections": true,
        "verify_adjacency_consistency": true,
        "validate_connection_endpoints": true,
        "check_weight_bounds": true
      }
    },
    
    "maintenance_rules": {
      "description": "Правила обслуживания графа",
      
      "decay_rules": {
        "enable_auto_decay": true,
        "decay_rate": 0.99,
        "decay_interval_seconds": 3600,
        "min_weight_after_decay": 0.01,
        "decay_inactive_only": false
      },
      
      "pruning_rules": {
        "enable_auto_pruning": true,
        "prune_interval_seconds": 3600,
        "weight_threshold": 0.02,
        "inactivity_threshold_seconds": 86400,
        "remove_orphaned_nodes": true,
        "preserve_percentage": 0.9
      },
      
      "compaction_rules": {
        "enable_auto_compaction": true,
        "compact_interval_seconds": 7200,
        "target_density": 0.1,
        "min_size_for_compaction": 10000,
        "preserve_hubs": true,
        "preserve_bridges": true
      }
    },
    
    "quality_metrics": {
      "description": "Метрики качества графа",
      
      "structure_quality": {
        "min_density": 0.001,
        "max_density": 0.5,
        "target_density": 0.1,
        "min_connectivity": 0.8,
        "max_components": 100
      },
      
      "evolution_quality": {
        "min_generation_fitness": 0.3,
        "target_generation_fitness": 0.7,
        "max_fitness_variance": 0.3,
        "min_diversity": 0.2
      },
      
      "performance_quality": {
        "max_avg_degree": 100,
        "max_hub_degree": 1000,
        "max_path_length": 20,
        "target_avg_path_length": 5
      }
    },
    
    "experience_integration": {
      "description": "Правила интеграции с Experience Stream",
      
      "event_recording": {
        "record_all_operations": true,
        "record_mutations": true,
        "record_crossovers": true,
        "record_selections": true,
        "record_statistics": false,
        "batch_events": true,
        "batch_size": 100
      },
      
      "reward_calculation": {
        "enable_rewards": true,
        "base_rewards": {
          "token_added": 0.1,
          "connection_created": 0.5,
          "bridge_connection": 0.8,
          "hub_creation": 0.6
        },
        "penalties": {
          "over_connection": -0.2,
          "weak_connection": -0.1,
          "redundant_connection": -0.3
        }
      },
      
      "state_tracking": {
        "include_graph_state": true,
        "state_components": [
          "node_count",
          "edge_count",
          "density",
          "average_degree",
          "connected_components"
        ],
        "normalize_state": true
      }
    },
    
    "security_rules": {
      "description": "Правила безопасности операций",
      
      "access_control": {
        "require_authentication": false,
        "check_permissions": false,
        "audit_log_operations": true
      },
      
      "resource_limits": {
        "max_operation_time_seconds": 60,
        "max_memory_mb": 1000,
        "max_batch_size": 1000,
        "rate_limit_operations": false
      },
      
      "data_protection": {
        "validate_input": true,
        "sanitize_metadata": true,
        "encrypt_sensitive": false,
        "backup_before_major_ops": false
      }
    },
    
    "error_handling": {
      "description": "Правила обработки ошибок",
      
      "operation_failures": {
        "retry_on_failure": false,
        "max_retries": 3,
        "rollback_on_error": true,
        "log_all_errors": true,
        "fail_silently": false
      },
      
      "validation_failures": {
        "strict_validation": true,
        "log_validation_errors": true,
        "return_error_details": true,
        "suggest_corrections": false
      },
      
      "recovery_strategies": {
        "auto_recovery": false,
        "preserve_partial_results": false,
        "notify_on_critical_errors": true
      }
    }
  }
}